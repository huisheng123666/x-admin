var Z=Object.defineProperty,ee=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var z=(m,a,s)=>a in m?Z(m,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):m[a]=s,M=(m,a)=>{for(var s in a||(a={}))le.call(a,s)&&z(m,s,a[s]);if($)for(var s of $(a))ue.call(a,s)&&z(m,s,a[s]);return m},q=(m,a)=>ee(m,te(a));import{u as oe}from"./query-table.5326dbda.js";import{s as j}from"./index.86ca5882.js";import{d as P,l as x,y as Y,b as Q,r as o,o as R,c as G,w as l,j as e,u as t,i as d,t as g,P as ae,f as ne,e as h,Q as se,h as ie,R as re}from"./vendor.76307f7a.js";const pe=d("\u63D0\u4EA4"),de=P({props:{visible:{type:Boolean}},emits:["close","update"],setup(m,{emit:a}){const s=m,f=x(),D=x(!1),n=Y({applyType:1,startTime:"",endTime:"",leaveTime:"0\u5929",reasons:""});function k(v,u,c){if(!u){c(new Error("\u8BF7\u8F93\u5165\u4F11\u5047\u539F\u56E0"));return}if(!n.startTime){c();return}const y=new Date(n.startTime).getTime();if(new Date(u).getTime()<y){c(new Error("\u7ED3\u675F\u65F6\u95F4\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E\u5F00\u59CB\u65F6\u95F4"));return}c()}const S=Y({startTime:[{required:!0,message:"\u8BF7\u9009\u62E9\u5F00\u59CB\u65F6\u95F4"}],endTime:[{required:!0,validator:k}],reasons:[{required:!0,message:"\u8BF7\u8F93\u5165\u4F11\u5047\u539F\u56E0"}]}),T=Q(()=>{if(!n.startTime||!n.endTime)return"0\u5929";const v=new Date(n.endTime).getTime()-new Date(n.startTime).getTime();return Math.ceil(v/(24*60*60*1e3))+1+"\u5929"}),A=()=>{f.value.resetFields(),a("close")};function w(){f.value.validate(v=>{v&&(D.value=!0,j.post("/leave/operate",{action:"add",params:q(M({},n),{leaveTime:T.value})}).then(()=>{D.value=!1,A(),a("update")}).catch(()=>{D.value=!1}))})}return(v,u)=>{const c=o("el-option"),y=o("el-select"),F=o("el-form-item"),V=o("el-date-picker"),C=o("el-input"),i=o("el-form"),b=o("el-button"),U=o("el-dialog");return R(),G(U,{title:"\u7533\u8BF7\u4F11\u5047","model-value":s.visible,"close-on-click-modal":!1,onClose:A,width:"700px"},{footer:l(()=>[e(b,{type:"primary",onClick:w},{default:l(()=>[pe]),_:1})]),default:l(()=>[e(i,{ref:(r,B)=>{B.formRef=r,f.value=r},model:t(n),rules:t(S),"label-width":"100px"},{default:l(()=>[e(F,{label:"\u4F11\u5047\u7C7B\u578B\uFF1A",prop:"applyType"},{default:l(()=>[e(y,{modelValue:t(n).applyType,"onUpdate:modelValue":u[0]||(u[0]=r=>t(n).applyType=r)},{default:l(()=>[e(c,{label:"\u4E8B\u5047",value:1}),e(c,{label:"\u8C03\u4F11",value:2}),e(c,{label:"\u5E74\u5047",value:3})]),_:1},8,["modelValue"])]),_:1}),e(F,{label:"\u5F00\u59CB\u65F6\u95F4\uFF1A",prop:"startTime"},{default:l(()=>[e(V,{"value-format":"YYYY-MM-DD",modelValue:t(n).startTime,"onUpdate:modelValue":u[1]||(u[1]=r=>t(n).startTime=r)},null,8,["modelValue"])]),_:1}),e(F,{label:"\u7ED3\u675F\u65F6\u95F4\uFF1A",prop:"endTime"},{default:l(()=>[e(V,{"value-format":"YYYY-MM-DD",modelValue:t(n).endTime,"onUpdate:modelValue":u[2]||(u[2]=r=>t(n).endTime=r)},null,8,["modelValue"])]),_:1}),e(F,{label:"\u4F11\u5047\u65F6\u957F\uFF1A"},{default:l(()=>[d(g(t(T)),1)]),_:1}),e(F,{label:"\u4F11\u5047\u539F\u56E0\uFF1A",prop:"reasons"},{default:l(()=>[e(C,{type:"textarea",modelValue:t(n).reasons,"onUpdate:modelValue":u[3]||(u[3]=r=>t(n).reasons=r),placeholder:"\u8BF7\u8F93\u5165\u4F11\u5047\u539F\u56E0"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["model-value"])}}}),me={class:"holiday"},ce={class:"query-form"},_e=d("\u67E5\u8BE2"),Fe=d("\u91CD\u7F6E"),fe={class:"base-table"},ve={class:"action"},be=d("\u7533\u8BF7\u4F11\u5047"),Be=d("\u67E5\u770B"),ge=d("\u4F5C\u5E9F"),Te={class:"pagination"},Ae=P({setup(m){const a=x(),s=x(!1),f=Y({applyState:""}),{tableData:D,filterTable:n,resetForm:k,tableLoading:S,page:T,dialogVisible:A,toggleDialog:w,changePage:v,editRow:u,getList:c}=oe({url:"/leave/list",formRef:a,form:f}),y=Q(()=>u.value?u.value.applyState<3?{active:u.value.applyState,lastText:"\u5BA1\u6279\u901A\u8FC7"}:{active:3,lastText:u.value.applyStateLabel}:{active:1,lastText:"\u5BA1\u6279\u901A\u8FC7"});function F(C,i=null){s.value=C,u.value=i}function V(C){re.confirm("\u786E\u8BA4\u4F5C\u5E9F\u8BE5\u7533\u8BF7","\u8B66\u544A",{confirmButtonText:"\u786E\u8BA4",cancelButtonText:"\u53D6\u6D88"}).then(i=>{j.post("/leave/operate",{_id:C._id,action:"delete"}).then(c)})}return(C,i)=>{const b=o("el-option"),U=o("el-select"),r=o("el-form-item"),B=o("el-button"),H=o("el-form"),_=o("el-table-column"),I=o("el-table"),J=o("el-pagination"),N=o("el-step"),K=o("el-steps"),E=o("el-descriptions-item"),O=o("el-descriptions"),W=o("el-dialog"),X=ae("loading");return R(),ne("div",me,[h("div",ce,[e(H,{inline:"",ref:(p,L)=>{L.formRef=p,a.value=p},model:t(f)},{default:l(()=>[e(r,{label:"\u5BA1\u6279\u72B6\u6001",prop:"applyState"},{default:l(()=>[e(U,{modelValue:t(f).applyState,"onUpdate:modelValue":i[0]||(i[0]=p=>t(f).applyState=p)},{default:l(()=>[e(b,{label:"\u5F85\u5BA1\u6279",value:1}),e(b,{label:"\u5BA1\u6279\u4E2D",value:2}),e(b,{label:"\u5BA1\u6279\u62D2\u7EDD",value:3}),e(b,{label:"\u5BA1\u6279\u901A\u8FC7",value:4}),e(b,{label:"\u4F5C\u5E9F",value:5})]),_:1},8,["modelValue"])]),_:1}),e(r,null,{default:l(()=>[e(B,{type:"primary",onClick:t(n)},{default:l(()=>[_e]),_:1},8,["onClick"]),e(B,{onClick:t(k)},{default:l(()=>[Fe]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),h("div",fe,[h("div",ve,[e(B,{onClick:i[1]||(i[1]=p=>t(w)(!0)),type:"primary"},{default:l(()=>[be]),_:1})]),se(e(I,{data:t(D)},{default:l(()=>[e(_,{label:"\u5355\u53F7",prop:"orderNo"}),e(_,{label:"\u4F11\u5047\u65F6\u95F4","show-overflow-tooltip":"",prop:"startTime"}),e(_,{label:"\u4F11\u5047\u65F6\u957F",prop:"leaveTime"}),e(_,{label:"\u4F11\u5047\u7C7B\u578B",prop:"applyTypeLabel"}),e(_,{label:"\u4F11\u5047\u539F\u56E0",prop:"reasons"}),e(_,{label:"\u7533\u8BF7\u65F6\u95F4","show-overflow-tooltip":"",prop:"createTime"}),e(_,{label:"\u5BA1\u6279\u4EBA",prop:"curAuditUserName"}),e(_,{label:"\u5F53\u524D\u5BA1\u6279\u4EBA",prop:"curAuditUser.userName","show-overflow-tooltip":""}),e(_,{label:"\u5F53\u524D\u72B6\u6001",prop:"applyStateLabel"}),e(_,{label:"\u64CD\u4F5C",width:"150"},{default:l(p=>[e(B,{size:"mini",onClick:L=>F(!0,p.row)},{default:l(()=>[Be]),_:2},1032,["onClick"]),e(B,{disabled:p.row.applyState>2,size:"mini",type:"danger",onClick:L=>V(p.row)},{default:l(()=>[ge]),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data"]),[[X,t(S)]]),h("div",Te,[e(J,{background:"",layout:"prev, pager, next",total:t(T).total,"current-page":t(T).pageNum,"page-size":t(T).pageSize,onCurrentChange:t(v)},null,8,["total","current-page","page-size","onCurrentChange"])])]),e(de,{visible:t(A),onClose:i[2]||(i[2]=p=>t(w)(!1)),onUpdate:t(c)},null,8,["visible","onUpdate"]),s.value?(R(),G(W,{key:0,title:"\u4F11\u5047\u8BE6\u60C5",width:"600px",modelValue:s.value,"onUpdate:modelValue":i[3]||(i[3]=p=>s.value=p),onClose:i[4]||(i[4]=p=>F(!1)),"destroy-on-close":""},{default:l(()=>[e(K,{active:t(y).active,"align-center":""},{default:l(()=>[e(N,{title:"\u5F85\u5BA1\u6279"}),e(N,{title:"\u5BA1\u6279\u4E2D"}),e(N,{title:t(y).lastText},null,8,["title"])]),_:1},8,["active"]),e(O,{column:2,style:{"margin-top":"20px",padding:"0 65px"},size:"normal"},{default:l(()=>[e(E,{label:"\u4F11\u5047\u7C7B\u578B"},{default:l(()=>[d(g(t(u).applyTypeLabel),1)]),_:1}),e(E,{label:"\u4F11\u5047\u65F6\u95F4"},{default:l(()=>[d(g(t(u).startTime),1)]),_:1}),e(E,{label:"\u4F11\u5047\u65F6\u957F"},{default:l(()=>[d(g(t(u).leaveTime),1)]),_:1}),e(E,{label:"\u4F11\u5047\u539F\u56E0"},{default:l(()=>[d(g(t(u).reasons),1)]),_:1}),e(E,{label:"\u5BA1\u6279\u72B6\u6001"},{default:l(()=>[d(g(t(u).applyStateLabel),1)]),_:1}),e(E,{label:"\u5BA1\u6279\u4EBA"},{default:l(()=>[d(g(t(u).curAuditUser.userName),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])):ie("",!0)])}}});export{Ae as default};
