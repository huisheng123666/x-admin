var le=Object.defineProperty;var T=Object.getOwnPropertySymbols;var ue=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var M=(p,m,a)=>m in p?le(p,m,{enumerable:!0,configurable:!0,writable:!0,value:a}):p[m]=a,R=(p,m)=>{for(var a in m||(m={}))ue.call(m,a)&&M(p,a,m[a]);if(T)for(var a of T(m))te.call(m,a)&&M(p,a,m[a]);return p};import{u as oe}from"./query-table.1b67047e.js";import{s as P}from"./index.61b28d01.js";import{d as Q,k as O,y as S,l as h,b as G,p as ae,r as s,o as L,c as H,w as u,j as e,u as l,f as J,g as se,F as ne,i as b,E as re,P as K,e as U,Q as y,t as ie}from"./vendor.1d842864.js";const de=b("\u53D6\u6D88"),me=b("\u786E\u8BA4"),pe=Q({props:{dialogVisible:{type:Boolean},defaultVal:null},emits:["close","update"],setup(p,{emit:m}){const a=p,j=O(),t=S({userName:"",userEmail:"",mobile:"",job:[],state:1,roleList:[],deptId:[]}),c=h(),w=h([]),A=G(()=>j.state.roles),B=h(!1),x=S({userName:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:"blur"}],userEmail:[{type:"email",required:!0,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u90AE\u7BB1",trigger:"blur"}],mobile:[{required:!0,message:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7",trigger:"blur"},{pattern:/^1\d{10}$/,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7"}],roleList:[{required:!0,message:"\u8BF7\u9009\u62E9\u89D2\u8272",trigger:"change"}]}),v=()=>{c.value.resetFields(),m("close")},$=()=>{c.value.validate(n=>{n&&(B.value=!0,R({},t),a.defaultVal&&a.defaultVal.userId,P.post("/users/operate",R({},t)).then(()=>{B.value=!1,v(),m("update"),re.success(`${a.defaultVal?"\u66F4\u65B0":"\u65B0\u589E"}\u6210\u529F`)}).catch(()=>{B.value=!1}))})},z=()=>{const{defaultVal:n}=a;n&&(t.userId=n.userId,t.userName=n.userName,t.userEmail=n.userEmail,t.mobile=n.mobile,t.job=n.job,t.state=n.state,t.roleList=n.roleList,t.deptId=n.deptId)};return ae(()=>{P.get("/dept/all").then(n=>{w.value=n})}),(n,r)=>{const F=s("el-input"),_=s("el-form-item"),V=s("el-option"),k=s("el-select"),D=s("el-cascader"),I=s("el-form"),i=s("el-button"),g=s("el-dialog");return L(),H(g,{title:p.defaultVal?"\u7F16\u8F91\u7528\u6237":"\u65B0\u589E\u7528\u6237","model-value":p.dialogVisible,width:"700px","close-on-click-modal":!1,onClose:v,onOpened:z},{footer:u(()=>[e(i,{onClick:v},{default:u(()=>[de]),_:1}),e(i,{type:"primary",onClick:$,loading:B.value},{default:u(()=>[me]),_:1},8,["loading"])]),default:u(()=>[e(I,{"label-width":"100px",model:l(t),rules:l(x),ref:(o,C)=>{C.formRef=o,c.value=o}},{default:u(()=>[e(_,{label:"\u7528\u6237\u540D",prop:"userName"},{default:u(()=>[e(F,{modelValue:l(t).userName,"onUpdate:modelValue":r[0]||(r[0]=o=>l(t).userName=o),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"},null,8,["modelValue"])]),_:1}),e(_,{label:"\u90AE\u7BB1",prop:"userEmail"},{default:u(()=>[e(F,{modelValue:l(t).userEmail,"onUpdate:modelValue":r[1]||(r[1]=o=>l(t).userEmail=o),placeholder:"\u8BF7\u8F93\u5165\u90AE\u7BB1"},null,8,["modelValue"])]),_:1}),e(_,{label:"\u624B\u673A\u53F7",prop:"mobile"},{default:u(()=>[e(F,{modelValue:l(t).mobile,"onUpdate:modelValue":r[2]||(r[2]=o=>l(t).mobile=o),placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7"},null,8,["modelValue"])]),_:1}),e(_,{label:"\u5C97\u4F4D",prop:"job"},{default:u(()=>[e(F,{modelValue:l(t).job,"onUpdate:modelValue":r[3]||(r[3]=o=>l(t).job=o),placeholder:"\u8BF7\u8F93\u5165\u5C97\u4F4D"},null,8,["modelValue"])]),_:1}),e(_,{label:"\u72B6\u6001",prop:"state"},{default:u(()=>[e(k,{modelValue:l(t).state,"onUpdate:modelValue":r[4]||(r[4]=o=>l(t).state=o)},{default:u(()=>[e(V,{label:"\u5728\u804C",value:1}),e(V,{label:"\u79BB\u804C",value:2}),e(V,{label:"\u8BD5\u7528\u671F",value:3})]),_:1},8,["modelValue"])]),_:1}),e(_,{label:"\u7CFB\u7EDF\u89D2\u8272",prop:"roleList"},{default:u(()=>[e(k,{style:{width:"100%"},multiple:"",modelValue:l(t).roleList,"onUpdate:modelValue":r[5]||(r[5]=o=>l(t).roleList=o)},{default:u(()=>[(L(!0),J(ne,null,se(l(A).originVal,o=>(L(),H(V,{key:o._id,value:o._id,label:o.roleName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(_,{label:"\u6240\u5C5E\u90E8\u95E8",prop:"deptId"},{default:u(()=>[e(D,{modelValue:l(t).deptId,"onUpdate:modelValue":r[6]||(r[6]=o=>l(t).deptId=o),options:w.value,"show-all-levels":!1,props:{checkStrictly:!0,value:"_id",label:"deptName"},clearable:""},null,8,["modelValue","options"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","model-value"])}}}),ce={class:"user-manage"},_e={class:"query-form"},fe=b("\u67E5\u8BE2"),be=b("\u91CD\u7F6E"),ge={class:"base-table"},ve={class:"action"},Fe=b("\u65B0\u589E"),Be=b("\u6279\u91CF\u5220\u9664"),Ve=b("\u7F16\u8F91"),Ce=b("\u5220\u9664"),Ee={class:"pagination"},Ie=Q({setup(p){const m=O(),a=h(),j={0:"\u6240\u6709",1:"\u5728\u804C",2:"\u79BB\u804C",3:"\u8BD5\u7528\u671F"},t=G(()=>m.state.roles),c=S({userId:"",userName:"",state:0});function w(I){if(t.value)return I.roleList.map(g=>{var o;return(o=t.value.mapVal[g])==null?void 0:o.roleName}).filter(g=>g).join(",")}const{resetForm:A,tableData:B,tableLoading:x,page:v,changePage:$,filterTable:z,selectedList:n,selectionChange:r,deleteRows:F,updateList:_,editRow:V,dialogVisible:k,toggleDialog:D}=oe({form:c,formRef:a,url:"/users/list",deleteUrl:"/users/delete"});return(I,i)=>{const g=s("el-input"),o=s("el-form-item"),C=s("el-option"),W=s("el-select"),E=s("el-button"),X=s("el-form"),f=s("el-table-column"),Y=s("el-table"),Z=s("el-pagination"),N=K("permission"),ee=K("loading");return L(),J("div",ce,[U("div",_e,[e(X,{inline:"",size:"mini",ref:(d,q)=>{q.formRef=d,a.value=d},model:l(c)},{default:u(()=>[e(o,{label:"\u7528\u6237ID\uFF1A",prop:"userId"},{default:u(()=>[e(g,{type:"number",modelValue:l(c).userId,"onUpdate:modelValue":i[0]||(i[0]=d=>l(c).userId=d),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),e(o,{label:"\u7528\u6237\u540D\uFF1A",prop:"userName"},{default:u(()=>[e(g,{modelValue:l(c).userName,"onUpdate:modelValue":i[1]||(i[1]=d=>l(c).userName=d)},null,8,["modelValue"])]),_:1}),e(o,{label:"\u72B6\u6001",prop:"state"},{default:u(()=>[e(W,{modelValue:l(c).state,"onUpdate:modelValue":i[2]||(i[2]=d=>l(c).state=d)},{default:u(()=>[e(C,{label:"\u6240\u6709",value:0}),e(C,{label:"\u5728\u804C",value:1}),e(C,{label:"\u79BB\u804C",value:2}),e(C,{label:"\u8BD5\u7528\u671F",value:3})]),_:1},8,["modelValue"])]),_:1}),e(o,null,{default:u(()=>[e(E,{type:"primary",onClick:l(z)},{default:u(()=>[fe]),_:1},8,["onClick"]),e(E,{onClick:l(A)},{default:u(()=>[be]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),U("div",ge,[U("div",ve,[y(e(E,{type:"primary",size:"mini",onClick:i[3]||(i[3]=d=>l(D)(!0))},{default:u(()=>[Fe]),_:1},512),[[N,["user:add"]]]),y(e(E,{onClick:i[4]||(i[4]=d=>l(F)(null,"userIds")),type:"danger",size:"mini",disabled:!l(n).length},{default:u(()=>[Be]),_:1},8,["disabled"]),[[N,["user:delete"]]])]),y(e(Y,{data:l(B),onSelectionChange:l(r)},{default:u(()=>[e(f,{type:"selection"}),e(f,{label:"\u7528\u6237ID",prop:"userId"}),e(f,{label:"\u7528\u6237\u540D",prop:"userName"}),e(f,{label:"\u7528\u6237\u90AE\u7BB1",prop:"userEmail","show-overflow-tooltip":""}),e(f,{label:"\u89D2\u8272",prop:"roleList",formatter:w,"show-overflow-tooltip":""}),e(f,{label:"\u7528\u6237\u72B6\u6001",width:"100"},{default:u(d=>[b(ie(j[d.row.state]),1)]),_:1}),e(f,{label:"\u6CE8\u518C\u65F6\u95F4",prop:"createTime","show-overflow-tooltip":""}),e(f,{label:"\u6700\u540E\u767B\u9646\u65F6\u95F4",prop:"lastLoginTime","show-overflow-tooltip":""}),e(f,{width:"150",label:"\u64CD\u4F5C"},{default:u(d=>[y(e(E,{size:"mini",type:"primary",onClick:q=>l(D)(!0,d.row)},{default:u(()=>[Ve]),_:2},1032,["onClick"]),[[N,["user:edit"]]]),y(e(E,{size:"mini",type:"danger",onClick:q=>l(F)(d.row.userId,"userIds")},{default:u(()=>[Ce]),_:2},1032,["onClick"]),[[N,["user:delete"]]])]),_:1})]),_:1},8,["data","onSelectionChange"]),[[ee,l(x)]]),U("div",Ee,[e(Z,{background:"",layout:"prev, pager, next",total:l(v).total,"current-page":l(v).pageNum,"page-size":l(v).pageSize,onCurrentChange:l($)},null,8,["total","current-page","page-size","onCurrentChange"])])]),e(pe,{"dialog-visible":l(k),onClose:i[5]||(i[5]=d=>l(D)(!1)),onUpdate:l(_),"default-val":l(V)},null,8,["dialog-visible","onUpdate","default-val"])])}}});export{Ie as default};
