var te=Object.defineProperty,le=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var T=(u,n,e)=>n in u?te(u,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[n]=e,P=(u,n)=>{for(var e in n||(n={}))ae.call(n,e)&&T(u,e,n[e]);if(q)for(var e of q(n))se.call(n,e)&&T(u,e,n[e]);return u},Q=(u,n)=>le(u,oe(n));import{u as ne}from"./query-table.8178c27a.js";import{s as E,_ as G}from"./index.5e7a82c7.js";import{d as I,k as U,l as C,y as S,p as O,r,o as $,c as K,w as s,j as t,u as a,i as b,q as ue,e as x,D as re,G as ie,E as de,P as H,f as ce,h as _e,Q as z}from"./vendor.1d842864.js";const pe=b("\u53D6\u6D88"),me=b("\u786E\u5B9A"),fe=I({props:{dialogVisible:{type:Boolean},defaultVal:null},emits:["close","update"],setup(u,{emit:n}){const e=u,w=U(),c=C();function m(){n("close"),c.value.resetFields()}const o=S({roleName:"",remark:""}),k=S({roleName:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0"}]});O(()=>{e.defaultVal&&(o.roleName=e.defaultVal.roleName,o.remark=e.defaultVal.remark)});function N(){c.value.validate(F=>{F&&E.post("/roles/operate",Q(P({},o),{action:e.defaultVal?"edit":"add",_id:e.defaultVal?e.defaultVal._id:null})).then(v=>{m(),n("update"),w.dispatch("getRoles")})})}return(F,v)=>{const y=r("el-input"),l=r("el-form-item"),f=r("el-form"),_=r("el-button"),h=r("el-dialog");return $(),K(h,{"model-value":e.dialogVisible,title:e.defaultVal?"\u7F16\u8F91\u89D2\u8272":"\u65B0\u589E\u89D2\u8272",width:"500px","close-on-click-modal":!1,onClose:m},{footer:s(()=>[t(_,{onClick:m},{default:s(()=>[pe]),_:1}),t(_,{type:"primary",onClick:N},{default:s(()=>[me]),_:1})]),default:s(()=>[t(f,{"label-width":"100px",model:a(o),size:"small",ref:(i,p)=>{p.formRef=i,c.value=i},rules:a(k)},{default:s(()=>[t(l,{label:"\u89D2\u8272\u540D\u79F0\uFF1A",prop:"roleName"},{default:s(()=>[t(y,{modelValue:a(o).roleName,"onUpdate:modelValue":v[0]||(v[0]=i=>a(o).roleName=i),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0"},null,8,["modelValue"])]),_:1}),t(l,{label:"\u5907\u6CE8\uFF1A",prop:"remark"},{default:s(()=>[t(y,{modelValue:a(o).remark,"onUpdate:modelValue":v[1]||(v[1]=i=>a(o).remark=i),type:"textarea",rows:5},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["model-value","title"])}}});const he=u=>(re("data-v-19d5134e"),u=u(),ie(),u),ve={class:"card-header"},ge=he(()=>x("span",null,"\u8BBE\u7F6E\u6743\u9650",-1)),ke=b("\u4FDD\u5B58"),be=I({props:{role:null},emits:["update"],setup(u,{emit:n}){const e=u,w=U(),c=C([]),m=C(),o=C([]),k=C(!1);function N(){E.post("/menu/default",{parentId:[]}).then(l=>{c.value=l})}function F(l,f){if(!!l.data._id){if(l.data.children&&l.data.children.length){f(l.data.children);return}E.post("/menu/children",{parentId:[...l.data.parentId,l.data._id]}).then(_=>{f(_)})}}O(()=>{var l;N(),e.role&&(o.value=e.role.permissionList||[],(l=m.value)==null||l.setCheckedKeys(o.value,!1))});function v(l,f){const _=new Set([...o.value,...f.checkedKeys]);o.value=[..._],E.get("/menu/child/keys",{params:{id:l._id}}).then(h=>{var i;if(f.checkedKeys.indexOf(l._id)>=0)o.value=[...o.value,...h];else{const p=[...o.value],D={[l._id]:!0};h.forEach(d=>{D[d]=!0});for(let d=0;d<p.length;d++)D[p[d]]&&(p.splice(d,1),d--);o.value=p,(i=m.value)==null||i.setCheckedKeys(o.value,!1)}})}ue(e,()=>{var l;e.role&&(o.value=e.role.permissionList||[],(l=m.value)==null||l.setCheckedKeys(o.value,!1))});function y(){var l;k.value=!0,E.post("/roles/permission",{action:"edit",_id:(l=e.role)==null?void 0:l._id,permissionList:o.value}).then(()=>{de.success("\u6743\u9650\u8BBE\u7F6E\u6210\u529F"),n("update"),k.value=!1,w.dispatch("getMenus")}).catch(()=>{k.value=!1})}return(l,f)=>{const _=r("el-button"),h=r("el-tree"),i=r("el-card");return $(),K(i,{class:"set-auth",shadow:"never"},{header:s(()=>[x("div",ve,[ge,t(_,{loading:k.value,disabled:!e.role,size:"mini",type:"primary",onClick:y},{default:s(()=>[ke]),_:1},8,["loading","disabled"])])]),default:s(()=>[t(h,{ref:(p,D)=>{D.treeRef=p,m.value=p},data:c.value,"value-key":"_id","node-key":"_id",lazy:"",load:F,"show-checkbox":"","check-strictly":"","default-checked-keys":o.value,props:{label:"menuName",isLeaf:"isLeaf"},onCheck:v},null,8,["data","default-checked-keys"])]),_:1})}}});var Ce=G(be,[["__scopeId","data-v-19d5134e"]]);const Fe={class:"roles"},ye={class:"query-form"},De=b("\u67E5\u8BE2"),Ve=b("\u91CD\u7F6E"),we=b("\u521B\u5EFA"),Ne={class:"base-table"},Be=b("\u7F16\u8F91"),Ee=b("\u5220\u9664"),xe={class:"pagination"},Re=I({setup(u){const n=C(),e=C(null),w=U(),c=S({roleName:""}),{tableData:m,page:o,tableLoading:k,editRow:N,updateList:F,changePage:v,filterTable:y,resetForm:l,getList:f,dialogVisible:_,toggleDialog:h,deleteRows:i}=ne({url:"/roles/list",formRef:n,form:c,deleteUrl:"/roles/operate"}),p=d=>{e.value=d};function D(d){i(d._id,"_id",!1,()=>{w.dispatch("getRoles")})}return(d,V)=>{const J=r("el-input"),M=r("el-form-item"),B=r("el-button"),W=r("el-form"),R=r("el-table-column"),X=r("el-table"),Y=r("el-pagination"),j=r("el-col"),Z=r("el-row"),L=H("permission"),ee=H("loading");return $(),ce("div",Fe,[x("div",ye,[t(W,{inline:"",size:"small",ref:(g,A)=>{A.formRef=g,n.value=g},model:a(c)},{default:s(()=>[t(M,{label:"\u89D2\u8272\u540D\u79F0\uFF1A",prop:"roleName"},{default:s(()=>[t(J,{placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0",modelValue:a(c).roleName,"onUpdate:modelValue":V[0]||(V[0]=g=>a(c).roleName=g)},null,8,["modelValue"])]),_:1}),t(M,null,{default:s(()=>[t(B,{type:"primary",onClick:a(y)},{default:s(()=>[De]),_:1},8,["onClick"]),t(B,{onClick:a(l)},{default:s(()=>[Ve]),_:1},8,["onClick"]),z(t(B,{type:"primary",onClick:V[1]||(V[1]=g=>a(h)(!0))},{default:s(()=>[we]),_:1},512),[[L,["role:add"]]])]),_:1})]),_:1},8,["model"])]),t(Z,{class:"roles-wrapper"},{default:s(()=>[t(j,{span:18},{default:s(()=>[x("div",Ne,[z(t(X,{data:a(m),border:"","highlight-current-row":"",onCurrentChange:p},{default:s(()=>[t(R,{label:"\u89D2\u8272\u540D\u79F0",prop:"roleName"}),t(R,{label:"\u5907\u6CE8",prop:"remark"}),t(R,{label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime","show-overflow-tooltip":""}),t(R,{label:"\u64CD\u4F5C",width:"150"},{default:s(g=>[z(t(B,{size:"mini",onClick:A=>a(h)(!0,g.row)},{default:s(()=>[Be]),_:2},1032,["onClick"]),[[L,["role:edit"]]]),z(t(B,{size:"mini",type:"danger",onClick:A=>D(g.row)},{default:s(()=>[Ee]),_:2},1032,["onClick"]),[[L,["role:delete"]]])]),_:1})]),_:1},8,["data"]),[[ee,a(k)]]),x("div",xe,[t(Y,{background:"",layout:"prev, pager, next",total:a(o).total,"current-page":a(o).pageNum,"page-size":a(o).pageSize,onCurrentChange:a(v)},null,8,["total","current-page","page-size","onCurrentChange"])])])]),_:1}),t(j,{span:6},{default:s(()=>[t(Ce,{onUpdate:a(f),role:e.value},null,8,["onUpdate","role"])]),_:1})]),_:1}),a(_)?($(),K(fe,{key:0,"dialog-visible":a(_),"default-val":a(N),onClose:V[2]||(V[2]=g=>a(h)(!1)),onUpdate:a(F)},null,8,["dialog-visible","default-val","onUpdate"])):_e("",!0)])}}});var Ie=G(Re,[["__scopeId","data-v-6c2ab0c2"]]);export{Ie as default};
