var P=Object.defineProperty;var $=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var j=(m,n,e)=>n in m?P(m,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):m[n]=e,q=(m,n)=>{for(var e in n||(n={}))S.call(n,e)&&j(m,e,n[e]);if($)for(var e of $(n))G.call(n,e)&&j(m,e,n[e]);return m};import{u as H}from"./query-table.39691fb9.js";import{s as D}from"./index.908b5ecc.js";import{T as J}from"./tree-select.e02b9774.js";import{d as z,l as F,y as A,p as K,r as i,o as k,c as U,w as u,j as t,u as l,f as Q,g as O,F as W,i as V,P as X,e as R,Q as T,h as Y}from"./vendor.1d842864.js";const Z=V("\u63D0\u4EA4"),ee=z({props:{dialogVisible:{type:Boolean},defaultVal:null},emits:["close","update"],setup(m,{emit:n}){const e=m,f=F(),h=F([]),v=F(!1),C=F([]);function N(){n("close"),f.value.resetFields()}const d=A({deptName:"",parentId:[],user:"",sortLevel:1}),I=A({deptName:[{required:!0,message:"\u8BF7\u8F93\u5165\u90E8\u95E8\u540D\u79F0"}],user:[{required:!0,message:"\u8BF7\u9009\u62E9\u8D1F\u8D23\u4EBA"}]});function B(){D.get("/users/all").then(a=>{h.value=a})}function E(){var a;D.post("/dept/default",{parentId:((a=e.defaultVal)==null?void 0:a.parentId)||[]}).then(o=>{C.value=o})}function L(a,o){if(!!a.data._id){if(a.data.children&&a.data.children.length){o(a.data.children);return}D.post("/dept/children",{parentId:[...a.data.parentId,a.data._id]}).then(p=>{o(p)})}}K(()=>{B(),E(),e.defaultVal&&(d.parentId=e.defaultVal.parentId,d.deptName=e.defaultVal.deptName,d.user=typeof e.defaultVal.user=="string"?"":e.defaultVal.user._id,d.sortLevel=e.defaultVal.sortLevel)});function y(){f.value.validate(a=>{var o;a&&(v.value=!0,D.post("/dept/operate",{action:e.defaultVal?"edit":"add",params:q({},d),_id:(o=e.defaultVal)==null?void 0:o._id}).then(()=>{n("update"),N(),v.value=!1}).catch(()=>{v.value=!1}))})}return(a,o)=>{const p=i("el-form-item"),c=i("el-input"),w=i("el-option"),_=i("el-select"),x=i("el-input-number"),g=i("el-form"),s=i("el-button"),b=i("el-dialog");return k(),U(b,{width:"40%","model-value":e.dialogVisible,title:e.defaultVal?"\u90E8\u95E8\u7F16\u8F91":"\u90E8\u95E8\u65B0\u589E","close-on-click-modal":!1,onClose:N},{footer:u(()=>[t(s,{type:"primary",onClick:y,loading:v.value},{default:u(()=>[Z]),_:1},8,["loading"])]),default:u(()=>[t(g,{model:l(d),ref:(r,M)=>{M.formRef=r,f.value=r},"label-width":"100px",rules:l(I)},{default:u(()=>[t(p,{label:"\u4E0A\u7EA7\u90E8\u95E8\uFF1A"},{default:u(()=>[t(J,{disabled:!!e.defaultVal,modelValue:l(d).parentId,"onUpdate:modelValue":o[0]||(o[0]=r=>l(d).parentId=r),"value-key":"_id","node-key":"_id",lazy:"",options:C.value,"parent-key":"parentId",load:L,"default-expanded-keys":l(d).parentId,"tree-props":{label:"deptName",isLeaf:"isLeaf"}},null,8,["disabled","modelValue","options","default-expanded-keys"])]),_:1}),t(p,{label:"\u90E8\u95E8\u540D\u79F0",prop:"deptName"},{default:u(()=>[t(c,{modelValue:l(d).deptName,"onUpdate:modelValue":o[1]||(o[1]=r=>l(d).deptName=r),placeholder:"\u8BF7\u8F93\u5165\u90E8\u95E8\u540D\u79F0"},null,8,["modelValue"])]),_:1}),t(p,{label:"\u8D1F\u8D23\u4EBA",prop:"user"},{default:u(()=>[t(_,{modelValue:l(d).user,"onUpdate:modelValue":o[2]||(o[2]=r=>l(d).user=r),placeholder:"\u8BF7\u9009\u62E9\u8D1F\u8D23\u4EBA"},{default:u(()=>[(k(!0),Q(W,null,O(h.value,r=>(k(),U(w,{key:r.userId,label:r.userName,value:r._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"\u6392\u5E8F",prop:"sortLevel"},{default:u(()=>[t(x,{modelValue:l(d).sortLevel,"onUpdate:modelValue":o[3]||(o[3]=r=>l(d).sortLevel=r)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["model-value","title"])}}}),te={class:"dept"},le={class:"query-form"},ae=V("\u67E5\u8BE2"),oe=V("\u91CD\u7F6E"),ue={class:"base-table"},de={class:"action"},ne=V("\u65B0\u589E"),se=V("\u7F16\u8F91"),re=V("\u5220\u9664"),_e=z({setup(m){const n=F(),e=F(),f=A({deptName:""}),{resetForm:h,filterTable:v,tableData:C,editRow:N,updateList:d,deleteRows:I,dialogVisible:B,toggleDialog:E}=H({url:"/dept/list",deleteUrl:"/dept/operate",form:f,formRef:n,tableRef:e});function L(y,a,o){D.post("/dept/children",{parentId:[...y.parentId,y._id]}).then(p=>{o(p)})}return(y,a)=>{const o=i("el-input"),p=i("el-form-item"),c=i("el-button"),w=i("el-form"),_=i("el-table-column"),x=i("el-table"),g=X("permission");return k(),Q("div",te,[R("div",le,[t(w,{inline:"",model:l(f),ref:(s,b)=>{b.formRef=s,n.value=s}},{default:u(()=>[t(p,{prop:"deptName"},{default:u(()=>[t(o,{modelValue:l(f).deptName,"onUpdate:modelValue":a[0]||(a[0]=s=>l(f).deptName=s),placeholder:"\u8BF7\u8F93\u5165\u90E8\u95E8\u540D\u79F0"},null,8,["modelValue"])]),_:1}),t(p,null,{default:u(()=>[t(c,{type:"primary",onClick:l(v)},{default:u(()=>[ae]),_:1},8,["onClick"]),t(c,{onClick:l(h)},{default:u(()=>[oe]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),R("div",ue,[R("div",de,[T(t(c,{type:"primary",onClick:a[1]||(a[1]=s=>l(E)(!0))},{default:u(()=>[ne]),_:1},512),[[g,["role:add"]]])]),t(x,{data:l(C),"row-key":"_id",border:"",lazy:"",load:L,ref:(s,b)=>{b.tableRef=s,e.value=s}},{default:u(()=>[t(_,{label:"\u90E8\u95E8\u540D\u79F0",prop:"deptName"}),t(_,{label:"\u8D1F\u8D23\u4EBA",prop:"user.userName"}),t(_,{label:"\u66F4\u65B0\u65F6\u95F4",prop:"updateTime"}),t(_,{label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime"}),t(_,{label:"\u64CD\u4F5C",width:"150"},{default:u(s=>[T(t(c,{type:"primary",size:"mini",onClick:b=>l(E)(!0,s.row)},{default:u(()=>[se]),_:2},1032,["onClick"]),[[g,["role:edit"]]]),T(t(c,{type:"danger",size:"mini",onClick:b=>l(I)(s.row._id,"_id",!1)},{default:u(()=>[re]),_:2},1032,["onClick"]),[[g,["role:delete"]]])]),_:1})]),_:1},8,["data"])]),l(B)?(k(),U(ee,{key:0,"default-val":l(N),"dialog-visible":l(B),onClose:a[2]||(a[2]=s=>l(E)(!1)),onUpdate:l(d)},null,8,["default-val","dialog-visible","onUpdate"])):Y("",!0)])}}});export{_e as default};
